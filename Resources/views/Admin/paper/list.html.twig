{% extends "AnhContentBundle::admin.html.twig" %}

{% import "AnhTaggableBundle::macro.html.twig" as taggable %}

{% block title %}Papers in {{ section }}{% endblock %}

{% block content %}
    <h2>{{ pager.getTotalRowsCount() }} papers in {{ section }}</h2>

    <form action="{{ url('anh_content_admin_paper_delete', { 'section': section }) }}" method="post" id="fPapers">
        <a href="{{ url('anh_content_admin_paper_add', { 'section': section }) }}">Create new</a>

        {% if not pager.isEmpty() %}
            <button type="submit">Delete</button>

            {% for paper in pager.getResult() %}
                <div>
                    <input type="checkbox" name="id[]" value="{{ paper.getId() }}" />
                    <a href="{{ url('anh_content_admin_paper_edit', { 'section': section, 'id': paper.getId() }) }}">{{ paper.getTitle() }}</a>
                    &middot; <a href="{{ url('anh_content_' ~ section ~ '_view', { 'id': paper.getId(), 'slug': paper.getSlug() }) }}">{{ paper.getSlug() }}</a>

                    {% if sections[section].category %}
                        &middot; {{ paper.getCategory().getTitle() }}
                    {% endif %}

                    {% if sections[section].publishedSince %}
                        &middot; {{ paper.getPublishedSince()|date }}
                    {% endif %}
{#
                    &middot; {{ paper.getCreatedAt()|date }}
                    &middot; {{ paper.getUpdatedAt()|date }}
#}
                    {% if sections[section].preview %}
                        <div>{{ paper.getPreview()|striptags[:100] ~ '...' }}</div>
                    {% endif %}

                    {% if sections[section].tags and not paper.getTags().isEmpty() %}
                        <div>{{ taggable.listTags(paper.getTags()) }}</div>
                    {% endif %}
                </div>
            {% endfor %}

            <div id="pager" class="paginator"></div>
        {% endif %}
    </form>
{% endblock %}

{% import 'AnhPagerBundle::macro.html.twig' as pagination %}

{% block stylesheets %}
    {{ pagination.stylesheets() }}
    {{ taggable.stylesheets() }}
{% endblock %}

{% block javascripts %}
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    {{ pagination.javascripts() }}
    {{ pagination.init('pager', pager) }}

    <script><!--
        $(function() {
            var check = function() {
                $('#fPapers button[type="submit"]').attr('disabled', $('#fPapers input[name="id[]"]:checked').length == 0);
            };

            $('#fPapers input[name="id[]"]').click(check);

            check();

            $('#fPapers').submit(function(event) {
                if(!confirm('Are you sure?')) {
                    event.preventDefault();
                }
            });
        });
    --></script>
{% endblock %}
